<section class="narrative-pulse">
    <div class="section-header">
        <div class="pulse-title-group">
            <h2 class="section-title">NARRATIVE PULSE</h2>
            <span class="section-subtitle">Topic momentum across 1,498 episodes</span>
        </div>
        <div class="pulse-controls">
            <button class="control-button" data-action="toggleTimeRange">
                <svg viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="6" cy="6" r="5"/>
                    <path d="M6 3v3l2 2"/>
                </svg>
                <span id="timeRangeText">7 days</span>
            </button>
            <button class="control-button" data-action="shareChart">
                <svg viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1.6">
                    <circle cx="3" cy="6" r="1.5"/>
                    <circle cx="9" cy="3" r="1.5"/>
                    <circle cx="9" cy="9" r="1.5"/>
                    <path d="M4.5 5.5L7.5 3.5M4.5 6.5L7.5 8.5"/>
                </svg>
                <span>Share</span>
            </button>
            <button class="control-button" data-action="customizeTopics">
                <svg viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round">
                    <path d="M5 1h2l.3 1.5a3.5 3.5 0 011.2.7L10 2.5l1 1.7-1.2.9a3.5 3.5 0 010 1.4l1.2.9-1 1.7-1.5-.7a3.5 3.5 0 01-1.2.7L7 11H5l-.3-1.5a3.5 3.5 0 01-1.2-.7L2 9.5l-1-1.7 1.2-.9a3.5 3.5 0 010-1.4L1 4.5l1-1.7 1.5.7a3.5 3.5 0 011.2-.7L5 1z"/>
                    <circle cx="6" cy="6" r="1.5"/>
                </svg>
                <span>Topics</span>
            </button>
        </div>
        
        <!-- Share dropdown -->
        <div class="share-dropdown" id="shareDropdown" style="display: none;">
            <button class="share-option" data-action="copyLink">
                <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M8 4H4a2 2 0 00-2 2v6a2 2 0 002 2h6a2 2 0 002-2V8"/>
                    <path d="M10 2h4v4M14 2L7 9"/>
                </svg>
                <span>Copy Link</span>
            </button>
            <button class="share-option" data-action="downloadImage">
                <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M3 10v3a1 1 0 001 1h8a1 1 0 001-1v-3"/>
                    <path d="M8 2v8M5 7l3 3 3-3"/>
                </svg>
                <span>Download Image</span>
            </button>
        </div>
    </div>
    
    <!-- Legend moved outside chart area -->
    <div class="pulse-legend">
        <div class="legend-item" data-topic="ai-infrastructure">
            <span class="legend-dot" style="background: #4a7c59;"></span>
            <span class="legend-label">AI Infrastructure</span>
            <span class="legend-value" style="color: #4a7c59;">+64%</span>
        </div>
        <div class="legend-item" data-topic="enterprise-agents">
            <span class="legend-dot" style="background: #f4a261;"></span>
            <span class="legend-label">Enterprise Agents</span>
            <span class="legend-value" style="color: #f4a261;">+107%</span>
        </div>
        <div class="legend-item" data-topic="defense-tech">
            <span class="legend-dot" style="background: #5a6c8c;"></span>
            <span class="legend-label">Defense Tech</span>
            <span class="legend-value" style="color: #5a6c8c;">+111%</span>
        </div>
        <div class="legend-item" data-topic="exit-strategies">
            <span class="legend-dot" style="background: #c77d7d;"></span>
            <span class="legend-label">Exit Strategies</span>
            <span class="legend-value" style="color: #c77d7d;">+50%</span>
        </div>
        <div class="legend-item" data-topic="vertical-ai">
            <span class="legend-dot" style="background: #8a68a8;"></span>
            <span class="legend-label">Vertical AI</span>
            <span class="legend-value" style="color: #8a68a8;">+60%</span>
        </div>
    </div>
    
    <!-- Legend tooltip (hidden by default) -->
    <div id="legendTooltip" class="legend-tooltip"></div>

    <div class="chart-wrapper">
        <!-- View Toggle Buttons -->
        <div class="view-toggle-group">
            <button class="view-toggle-btn active" data-view="momentum">Momentum</button>
            <button class="view-toggle-btn" data-view="volume">Volume</button>
            <button class="view-toggle-btn" data-view="consensus">Consensus</button>
        </div>
        
        <!-- Filter indicator (hidden by default) -->
        <div id="filterActive" class="filter-active">
            <span>Filtered: <span id="filterTopic"></span></span>
            <button class="filter-clear" data-action="clearTopicFilter">Ã—</button>
        </div>

        <div class="chart-container">
            <!-- Tooltip (hidden by default) -->
            <div id="chartTooltip" class="chart-tooltip"></div>

            <!-- Topic Velocity Chart with Dynamic Views -->
            <svg viewBox="0 0 800 280" style="width: 100%; height: 100%; pointer-events: all;" id="narrativeChart">
                <!-- Chart content will be inserted by JavaScript -->
                <g id="chartContent" style="pointer-events: all;">
                    <!-- Content will be dynamically generated by JavaScript -->
                </g>
            </svg>
        </div>
    </div>

    <div class="narrative-insights">
        <div class="insight-card">
            <div class="insight-icon">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="8" cy="8" r="6"/>
                    <circle cx="8" cy="8" r="3"/>
                    <circle cx="8" cy="8" r="1"/>
                </svg>
            </div>
            <div class="insight-text">
                <span class="insight-highlight">Strong Consensus:</span> AI infrastructure investment thesis validated across 12 sources
            </div>
        </div>
        <div class="insight-card">
            <div class="insight-icon">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M8 3L8 13M8 3L4 7M8 3L12 7"/>
                </svg>
            </div>
            <div class="insight-text">
                <span class="insight-highlight">Narrative Shift:</span> From "growth at all costs" to "efficient growth" - mentioned 47 times
            </div>
        </div>
        <div class="insight-card">
            <div class="insight-icon">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="5" cy="8" r="2"/>
                    <circle cx="11" cy="8" r="2"/>
                    <path d="M5 6V5C5 3 6 2 8 2C10 2 11 3 11 5V6"/>
                </svg>
            </div>
            <div class="insight-text">
                <span class="insight-highlight">Emerging Theme:</span> Developer tools seeing renewed interest after 2-year lull
            </div>
        </div>
    </div>
</section>

<!-- Topic Customization Panel (moved outside section for proper viewport positioning) -->
<div class="topic-customization-backdrop" style="display: none;"></div>
<div class="topic-customization-panel" data-state="closed">
    <!-- Header -->
    <div class="panel-header">
        <div>
            <h2>Customize Topics</h2>
            <p class="panel-subtitle">Track topics that matter to your thesis (max 5)</p>
        </div>
        <button class="close-button" data-action="closeCustomizationPanel">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
        </button>
    </div>
    <!-- Content -->
    <div class="panel-content">
        <!-- Topic List -->
        <div class="topic-list" id="topicList">
            <!-- Topics will be dynamically inserted here -->
        </div>
        <!-- Selection Counter -->
        <div class="selection-counter">
            <span id="selectionCount">0 of 5 topics selected</span>
        </div>
        <!-- Buttons -->
        <div class="panel-buttons">
            <button class="button-secondary" data-action="cancelCustomization">Cancel</button>
            <button class="button-primary" id="applyTopicsBtn" data-action="applyTopics" disabled>Apply Changes</button>
        </div>
    </div>
</div>