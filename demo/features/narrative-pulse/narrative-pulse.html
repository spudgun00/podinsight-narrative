<section class="narrative-pulse">
    <div class="section-header">
        <div class="pulse-title-group">
            <h2 class="section-title">NARRATIVE PULSE</h2>
            <span class="section-subtitle">Topic momentum across 1,498 episodes</span>
        </div>
        <div class="pulse-controls">
            <button class="control-button" data-action="toggleTimeRange">
                <svg viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="6" cy="6" r="5"/>
                    <path d="M6 3v3l2 2"/>
                </svg>
                <span id="timeRangeText">30 days</span>
            </button>
            <button class="control-button" data-action="toggleView">
                <svg viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="2" y="2" width="8" height="8" rx="1"/>
                    <line x1="2" y1="6" x2="10" y2="6"/>
                    <line x1="6" y1="2" x2="6" y2="10"/>
                </svg>
                <span id="viewText">Momentum</span>
            </button>
            <button class="control-button" data-action="customizeTopics">
                <span>⚙️</span>
                <span>Customize Topics</span>
            </button>
        </div>
    </div>
    
    <!-- Legend moved outside chart area -->
    <div class="pulse-legend">
        <div class="legend-item" data-mentions="anthropic,openai">
            <span class="legend-dot" style="background: var(--sage);"></span>
            <span class="legend-label">AI Agents</span>
            <span class="legend-value" style="color: var(--sage);">+85%</span>
        </div>
        <div class="legend-item">
            <span class="legend-dot" style="background: var(--amber-glow);"></span>
            <span class="legend-label">Capital Efficiency</span>
            <span class="legend-value" style="color: var(--amber-glow);">+17%</span>
        </div>
        <div class="legend-item">
            <span class="legend-dot" style="background: var(--slate-blue);"></span>
            <span class="legend-label">DePIN</span>
            <span class="legend-value" style="color: var(--slate-blue);">+190%</span>
        </div>
        <div class="legend-item">
            <span class="legend-dot" style="background: var(--dusty-rose);"></span>
            <span class="legend-label">B2B SaaS</span>
            <span class="legend-value" style="color: var(--dusty-rose);">+3%</span>
        </div>
    </div>

    <div class="chart-wrapper">
        <!-- Filter indicator (hidden by default) -->
        <div id="filterActive" class="filter-active">
            <span>Filtered: <span id="filterTopic"></span></span>
            <button class="filter-clear" data-action="clearTopicFilter">×</button>
        </div>

        <div class="chart-container">
            <!-- Tooltip (hidden by default) -->
            <div id="chartTooltip" class="chart-tooltip"></div>

            <!-- Topic Velocity Chart with Dynamic Views -->
            <svg viewBox="0 0 800 280" style="width: 100%; height: 100%; pointer-events: all;" id="narrativeChart">
                <!-- Chart content will be inserted by JavaScript -->
                <g id="chartContent" style="pointer-events: all;">
                    <!-- Content will be dynamically generated by JavaScript -->
                </g>
            </svg>
        </div>
    </div>

    <div class="narrative-insights">
        <div class="insight-card">
            <div class="insight-icon">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="8" cy="8" r="6"/>
                    <circle cx="8" cy="8" r="3"/>
                    <circle cx="8" cy="8" r="1"/>
                </svg>
            </div>
            <div class="insight-text">
                <span class="insight-highlight">Strong Consensus:</span> AI infrastructure investment thesis validated across 12 sources
            </div>
        </div>
        <div class="insight-card">
            <div class="insight-icon">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 6H2L2 2M2 10L2 14L14 14L14 10M5 8L11 8"/>
                </svg>
            </div>
            <div class="insight-text">
                <span class="insight-highlight">Narrative Shift:</span> From "growth at all costs" to "efficient growth" - mentioned 47 times
            </div>
        </div>
        <div class="insight-card">
            <div class="insight-icon">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="5" cy="8" r="2"/>
                    <circle cx="11" cy="8" r="2"/>
                    <path d="M5 6V5C5 3 6 2 8 2C10 2 11 3 11 5V6"/>
                </svg>
            </div>
            <div class="insight-text">
                <span class="insight-highlight">Emerging Theme:</span> Developer tools seeing renewed interest after 2-year lull
            </div>
        </div>
    </div>
</section>

<!-- Topic Customization Panel (moved outside section for proper viewport positioning) -->
<div class="topic-customization-backdrop" style="display: none;"></div>
<div class="topic-customization-panel" data-state="closed">
    <!-- Header -->
    <div class="panel-header">
        <div>
            <h2>Customize Topics</h2>
            <p class="panel-subtitle">Track topics that matter to your thesis (max 4)</p>
        </div>
        <button class="close-button" data-action="closeCustomizationPanel">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
        </button>
    </div>
    <!-- Content -->
    <div class="panel-content">
        <!-- Topic List -->
        <div class="topic-list" id="topicList">
            <!-- Topics will be dynamically inserted here -->
        </div>
        <!-- Selection Counter -->
        <div class="selection-counter">
            <span id="selectionCount">0 of 4 topics selected</span>
        </div>
        <!-- Buttons -->
        <div class="panel-buttons">
            <button class="button-secondary" data-action="cancelCustomization">Cancel</button>
            <button class="button-primary" id="applyTopicsBtn" data-action="applyTopics" disabled>Apply Changes</button>
        </div>
    </div>
</div>