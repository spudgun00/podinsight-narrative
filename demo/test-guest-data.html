<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Guest Data Extraction</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 { margin-bottom: 20px; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #f5f5f5;
            font-weight: 600;
        }
        .old-data { color: #d00; }
        .new-data { color: #0a0; }
        .match { background: #e8f5e9; }
        .mismatch { background: #ffebee; }
    </style>
</head>
<body>
    <h1>Guest Data Comparison</h1>
    <p>Comparing guest data from unified-data.js (old) vs backup data (new)</p>
    
    <table id="comparison">
        <thead>
            <tr>
                <th>Episode ID</th>
                <th>Title</th>
                <th>Old Guest Data (Mixed)</th>
                <th>New Guest Data (Clean)</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <!-- Will be populated by JavaScript -->
        </tbody>
    </table>

    <script src="data/unified-data.js"></script>
    <script src="data/priorityBriefings_backup_20250805_213425.js"></script>
    <script>
        // Wait for data to load
        setTimeout(() => {
            const tbody = document.getElementById('tableBody');
            
            // Get episodes from unified data
            const episodes = window.unifiedData?.priorityBriefings?.items || [];
            
            // Create guest lookup from backup data
            const guestLookup = {};
            if (window.backupData && window.backupData.priorityBriefings && window.backupData.priorityBriefings.items) {
                window.backupData.priorityBriefings.items.forEach(item => {
                    if (item.id && item.guest) {
                        guestLookup[item.id] = item.guest;
                    }
                });
            }
            
            // Compare data
            episodes.forEach(episode => {
                const card = episode.cardView || episode;
                const oldGuest = card.guests || card.guest || 'No data';
                const newGuest = guestLookup[episode.id] || 'Not found in backup';
                const isClean = !oldGuest.includes('+') && !oldGuest.includes('(') && oldGuest === newGuest;
                
                const row = document.createElement('tr');
                row.className = isClean ? 'match' : 'mismatch';
                row.innerHTML = `
                    <td>${episode.id}</td>
                    <td>${card.title?.substring(0, 50)}...</td>
                    <td class="old-data">${oldGuest}</td>
                    <td class="new-data">${newGuest}</td>
                    <td>${isClean ? 'âœ… Clean' : 'ðŸ”„ Improved'}</td>
                `;
                tbody.appendChild(row);
            });
            
            console.log('Guest lookup created with', Object.keys(guestLookup).length, 'entries');
            console.log('Sample lookup:', Object.entries(guestLookup).slice(0, 3));
        }, 1000);
    </script>
</body>
</html>