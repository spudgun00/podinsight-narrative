<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Narrative Pulse Test</title>
    <style>
        body {
            margin: 20px;
            font-family: system-ui, -apple-system, sans-serif;
        }
        .test-results {
            margin: 20px 0;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 8px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 4px;
        }
        .success { color: green; }
        .error { color: red; }
        pre {
            background: #f0f0f0;
            padding: 10px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>Narrative Pulse Test - New Topics</h1>
    <div id="test-results" class="test-results">
        <h2>Test Results:</h2>
    </div>

    <!-- Load all required scripts -->
    <script src="data/unified-data.js"></script>
    <script src="features/narrative-pulse/unified-data-adapter.js"></script>
    <script src="features/narrative-pulse/narrative-pulse.js"></script>
    <script src="features/narrative-pulse/apply-data-updates.js"></script>

    <script>
        // Wait for all scripts to load
        setTimeout(() => {
            // Initialize NarrativePulse with a mock container
            const mockContainer = document.createElement('div');
            mockContainer.innerHTML = '<div class="chart-container"></div>';
            
            // Only initialize if NarrativePulse exists
            if (window.NarrativePulse && window.NarrativePulse.init) {
                try {
                    window.NarrativePulse.init(mockContainer);
                } catch (e) {
                    console.error('Error initializing NarrativePulse:', e);
                }
            }
            
            // Now run tests
            setTimeout(() => {
            const results = document.getElementById('test-results');
            
            // Test 1: Check if unified data loaded
            const test1 = document.createElement('div');
            test1.className = 'test-result';
            if (window.unifiedData && window.unifiedData.narrativePulse) {
                test1.innerHTML = '<span class="success">✓</span> Unified data loaded successfully';
                const topics = Object.keys(window.unifiedData.narrativePulse.topics);
                test1.innerHTML += '<br>Topics found: ' + topics.join(', ');
            } else {
                test1.innerHTML = '<span class="error">✗</span> Failed to load unified data';
            }
            results.appendChild(test1);

            // Test 2: Check if narrativePulseData was created
            const test2 = document.createElement('div');
            test2.className = 'test-result';
            if (window.narrativePulseData) {
                test2.innerHTML = '<span class="success">✓</span> narrativePulseData created successfully';
                const sevenDayTopics = Object.keys(window.narrativePulseData.sevenDayData.topics);
                test2.innerHTML += '<br>7-day topics: ' + sevenDayTopics.join(', ');
            } else {
                test2.innerHTML = '<span class="error">✗</span> Failed to create narrativePulseData';
            }
            results.appendChild(test2);

            // Test 3: Check NarrativePulse object
            const test3 = document.createElement('div');
            test3.className = 'test-result';
            if (window.NarrativePulse) {
                test3.innerHTML = '<span class="success">✓</span> NarrativePulse object exists';
                test3.innerHTML += '<br>Available topics: ' + (window.NarrativePulse.availableTopics || []).join(', ');
                test3.innerHTML += '<br>Selected topics: ' + (window.NarrativePulse.selectedTopics || []).join(', ');
            } else {
                test3.innerHTML = '<span class="error">✗</span> NarrativePulse object not found';
            }
            results.appendChild(test3);

            // Test 4: Check timeRangeData
            const test4 = document.createElement('div');
            test4.className = 'test-result';
            if (window.NarrativePulse && window.NarrativePulse.timeRangeData) {
                const hasData = Object.keys(window.NarrativePulse.timeRangeData['7 days'].topics).length > 0;
                if (hasData) {
                    test4.innerHTML = '<span class="success">✓</span> timeRangeData populated from unified data';
                    const topics = Object.keys(window.NarrativePulse.timeRangeData['7 days'].topics);
                    test4.innerHTML += '<br>Topics in timeRangeData: ' + topics.join(', ');
                } else {
                    test4.innerHTML = '<span class="error">✗</span> timeRangeData is empty';
                }
            } else {
                test4.innerHTML = '<span class="error">✗</span> timeRangeData not found';
            }
            results.appendChild(test4);

            // Test 5: Display sample data
            const test5 = document.createElement('div');
            test5.className = 'test-result';
            test5.innerHTML = '<h3>Sample Topic Data (AI Infrastructure):</h3>';
            if (window.NarrativePulse && window.NarrativePulse.timeRangeData['7 days'].topics['AI Infrastructure']) {
                const topicData = window.NarrativePulse.timeRangeData['7 days'].topics['AI Infrastructure'];
                test5.innerHTML += '<pre>' + JSON.stringify(topicData, null, 2) + '</pre>';
            }
            results.appendChild(test5);

            }, 500);
        }, 1000);
    </script>
</body>
</html>